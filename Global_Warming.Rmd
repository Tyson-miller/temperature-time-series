---
title: "STAT 261 Project"
author: "Tyson Miller"
date: "12/5/2019"
output:
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
library(MASS)
library(gridExtra)
library(tidyverse)
library(mosaic)
library(broom)
library(ggplot2)
library(GGally)
library(car)
library(dplyr)
library(astsa)
library(pracma)
library(aTSA)
# Set numerical output display parameters
options(width=70, digits=4, scipen=8)
# Set R output size a bit smaller than default
knitr::opts_chunk$set(size='small', prompt=FALSE, comment="")
# set plot theme to black and white
ggplot2::theme_set(ggplot2::theme_bw())
ggplot2::theme_update(panel.grid.major = ggplot2::element_line(colour = "grey75"))
```

## 1. Introduction
Over the past few decades, global warming has become an increasingly critical issue as we are already experiencing the early effects and beginning to speculate the later, much more dire effects. The Central England temperature series is the longest instrumental temperature time series, making it a valuable tool to discuss long-term climate change. The CET data is a measurement of average seasonal temperature in a region representative of Central England every year dating back to 1659. The seasons are Winter, Spring, Summer and Fall and the measurements are recorded as the average of the 3 monthly averages corresponding to each season. December-January-February represents Winter, March-April-May represents Spring, June-July-August represents Summer, and September-November-December represents Fall. By taking the average of the four seasonal columns, we can get a time series of average temperature per year and by using time series analysis techniques we can get a sense of the long-term trend, if there is one, in Central England temperature variation. Given the importance of global warming, our focus will be to explore the issue of estimation of the trend component.    

## 2. Analysis
The first thing we notice about this time series is that it does not appear to be stationary. Looking at the moving average smoother (blue) using a normal kernel function, there seems to be a clear upward trend over time and especially in the last 20 years but it is somewhat hard to decipher visually and will require more in-depth analysis. Furthermore, looking at the spline method smooth curve (red) we can see that the long-term trend might be best fit by a cubic or that there are three periods of temperature change between 1660 and 2019. If we increase the smoothing paramater and smooth again using spline method (green) we can see that even a long-term linear trend looks possible like Jones and Hulme (1997) and Jones and Bradley (1992a) postulated. Another critical function when talking about global warming is predicting future temperatures. In order to forecast, we need to be able to fit a model to the data which can only be done if the time series is stationary or transformed to be stationary. Two ways of doing this are differencing and detrending using regression. However, since we are interested in estimating the trend, we will opt not to difference because that removes the possibility of analyzing the trend itself.

```{r, echo=FALSE}
data = read.table("England_temp_timeseries.txt", col.names = c("Year", "Winter", "Spring", "Summer", "Fall"), skip = 2)
data$Annual = rowMeans(data[2:5])
winter_data = ts(data["Winter"][c(2:361), 1],start = 1660)
spring_data = ts(data["Spring"][,1],start = 1659)
summer_data = ts(data["Summer"][,1],start = 1659)
fall_data = ts(data["Fall"][c(1:360),1],start = 1659)
annual_data = ts(data["Annual"][c(2:360),1], start = 1660)

```

```{r, echo=FALSE}
plot(annual_data, main = "Central England Annual Average Temperature", xlab = "Time (years)", ylab = "Temperature (Celsius)")
lines(ksmooth(time(annual_data), annual_data, "normal", bandwidth=8), lwd=2, col= 'blue')
lines(smooth.spline(time(annual_data), annual_data, spar=1), lwd=2, col='red')
lines(smooth.spline(time(annual_data), annual_data, spar=2), lwd=2, col='green')
legend('bottomright', legend=c("Normal Kernel", "Cubic Spline", "Linear Spline"), col = c("blue", "red", "green"), lty = 1)
```



```{r, echo=FALSE}
time_data = (time(annual_data) - 1659)
reg <- lm(annual_data~time_data, na.action = NULL)
detrended_data = resid(reg)

reg2 <- lm(annual_data~time_data + I(time_data^2))
detrended_data2 = resid(reg2)


reg3 <- lm(annual_data~time_data + I(time_data^2) + I(time_data^3))
detrended_data3 = resid(reg3)

par(mfrow = c(3,1))
plot(detrended_data, main = "Linear Detrended Data", xlab = "Time (years)", ylab = "Residuals of Linear Regression")

plot(detrended_data, main = "Quadratic Detrended Data", xlab = "Time (years)", ylab = "Residuals of Quadratic Regression")

plot(detrended_data, main = "Cubic Detrended Data", xlab = "Time (years)", ylab = "Residuals of Cubic Regression")
```

```{r, echo=FALSE}
par(mfrow = c(2, 2))
plot(annual_data, main = "Time Series with Linear Trend Line")
points(time(annual_data),predict.lm(reg),type='l',col='red')

acf(detrended_data )
acf(detrended_data, type = "partial")

summary(reg)
```

```{r, echo=FALSE}
acf(detrended_data)
pacf(detrended_data)
```

```{r, echo=FALSE}
summary(reg)
```

```{r, echo=FALSE}
plot(annual_data, main = "Time Series with Quadratic Trend")
points(time(annual_data),predict.lm(reg2),type='l',col='red')
```

```{r, echo=FALSE}
acf2(detrended_data2)
```

```{r, echo=FALSE}
summary(reg2)
```

```{r, echo=FALSE}
plot(annual_data, main = "Time Series with Cubic Trend")
points(time(annual_data),predict.lm(reg3),type='l',col='red')
```

```{r, echo=FALSE}
acf2(detrended_data3)
```
```{r, echo=FALSE}
summary(reg3)
```


If we model the trend as linear as Jones and Hulme (1997) and Jones and Bradley (1992a) did, we see that the adjusted R^2 value is .172 and the ACF and PACF plots look much better than the original data which means this could be a feasible model for the long-term warming trend.  

Analyzing the ACF and PACF plots of the 3 forms of detrended data, we see that the quadratic and cubic estimates of the trend are both better than the linear estimate. Between the two, they are comparable and we will follow Wand and Jones (1995) and Simonoff (1996) as well as Zhang and Wu (2011) who all advocate for the cubic trend and choose this one as best. Also, comparing the model statistics of the 3 fits, the cubic fit has a higher R^2 value to it accounts for more of the variance in the model than the other two fits and the cubic fit also has the smallest BIC value which also leads us to believe that this model for the trend is the most appropriate.


